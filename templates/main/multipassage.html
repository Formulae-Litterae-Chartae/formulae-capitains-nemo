{% extends "main::text_container.html" %}

{% macro header_passage(object) %}
<header>
    <h1 class="entry-title text-center">{{object.collections.current.title}}</h1>
    <h2 class="author vcard text-center"><span class="fn">{{object.collections.current.author}}</span></h2>
    <p class="entry-summary text-center"><small>{{object.collections.current.label}}</small></p>
    <p class="entry-summary text-center"><button type="button" class="btn btn-link" data-toggle="modal" data-target="#{{ object.objectId|replace(':', '')|replace('.', '') }}-modal">Regest</button></p>
    <span class='Z3988' title='{{object.collections.current.coins}}'></span>
    <!-- The Modal Content for the Regest -->
    <div class="modal fade" id="{{ object.objectId|replace(':', '')|replace('.', '') }}-modal" tabindex="-1" role="dialog" aria-labelledby="{{ object.objectId|replace(':', '')|replace('.', '') }}-modalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
        <div class="modal-header">
            <h5 class="modal-title" id="{{ object.objectId|replace(':', '')|replace('.', '') }}-modalLabel">{{object.collections.current.label}}</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
            </button>
        </div>
        <div class="modal-body">
        {{object.collections.current.description}}
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        </div>
        </div>
    </div>
    </div>
</header>
{% endmacro %}

{% macro nav() %}
    {% if prev %}
    <a class="btn btn-xs btn-primary" href="{{url_for('.r_passage', objectId=objectId, subreference=prev) }}">
        <span class="glyphicon glyphicon-chevron-left"></span>
    </a>
    {% endif %}
    {% if next %}
    <a class="btn btn-xs btn-primary" href="{{url_for('.r_passage', objectId=objectId, subreference=next) }}">
        <span class="glyphicon glyphicon-chevron-right"></span>
    </a>
    {% endif %}
{% endmacro %}

{% macro default_footer() %}
    {% include "main::passage_footer.html" %}
{% endmacro %}

{% macro show_passage(objects) %}
    <div class="">
        <article class="hentry entry white col-sm-12">
            <!-- <nav>
                {{ navigation }}
            </nav> -->
            <div class="row">
            {% for text in objects %}
            {%set all_texts = objects|map(attribute='objectId')|list %}
            {%set all_reffs = objects|map(attribute='subreference')|list %}
                {% if loop.last %}
                <section class="col-sm">
                {% else %}
                <section class="col-sm with-border">
                {% endif %}
                {% if objects|length > 1 %}
                <a href="{{ url_for('.r_multipassage', objectIds=all_texts|remove_from_list(text.objectId)|join_list_values('+'), subreferences=all_reffs|remove_from_list(text.subreference)|join_list_values('+')) }}">Remove this text</a>
                {% endif %}
                    {{ header_passage(text) }}
                    {% if text.pdf_path == '' %}
                        {% if cache_active %}
                            {% cache cache_time, cache_key %}{{ text.text_passage }} {% endcache %}
                        {% else %}
                            {{ text.text_passage }}
                        {% endif %}
                    {% else %}
                        <div class="embed-responsive embed-responsive-a4">
                            <object data="{{url_for('.static', filename=text.pdf_path)}}" class="embed-responsive-item"></object>
                        </div>
                    {% endif %}
                </section>
            {% endfor %}
            </div>
        </article>
    </div>
{% endmacro %}

{% block texts %}

{{ show_passage(objects) }}

{% endblock %}

{% block pdfs %}

<div class="row">
    {% for text in objects %}
    {% set path = 'images/' ~ text.objectId ~ '.pdf' %}
    <section class="col-sm">
        <div class="embed-responsive embed-responsive-1by1">
            <object data="{{url_for('.static', filename=path)}}" class="embed-responsive-item"></object>
        </div>
    </section>
    {% endfor %}
</div>
{% endblock %}

{% block metadata %}
{% endblock %}
